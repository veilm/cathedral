<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<title>night-board</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
:root{
  --bg:#0e0e12;
  --ink:#d7e6ff;
  --accent:#00b4ff;
  --noise:rgba(255,255,255,.02);

  --serif:"Spectral", "Georgia", serif;
  --sans :"Inter", Helvetica, Arial, sans-serif;
}
body{
  margin:0;
  height:100vh;
  background:var(--bg);
  color:var(--ink);
  font-family:var(--serif);
  font-size:1.37rem;
  line-height:1.58;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
#grain{
  position:fixed;inset:0;pointer-events:none;
}
#board{
  flex:1 1 auto;
  overflow:auto;
  padding:4vh 4vw;
}
.message{
  max-width:45rem;
  margin:.3rem auto 2rem;
  padding:1.3rem 0;
  border-left:1px solid transparent;
  position:relative;
  transition:all .65s;
}
/* the type-guide shimmer */
.message::before{
  content:'';
  position:absolute;
  left:0;top:50%;
  width:20px;height:1px;
  background:linear-gradient(90deg,var(--accent),transparent);
  transform:scaleX(0);
  animation:shimmer .9s ease-out forwards;
  transform-origin:left;
}
@keyframes shimmer{to{transform:scaleX(1)}}

.user{font-family:var(--sans);}
.user{text-align:right;border-left:none;}
.user::before{transform-origin:right;right:0;left:auto;}

/* breathing animation on idle (vertical-only) */
.animate{
  padding-top:2.4rem;
  padding-bottom:2.4rem;
}
/* INPUT CIRCLE */
#input-void{
  flex-shrink:0;
  position:relative;
  margin:0 auto 3rem;
  width:62px;
  height:62px;
  border:2px solid var(--accent);
  border-radius:50%;
  transition:all .45s cubic-bezier(.6,.02,.4,1);
  cursor:text;
  opacity:.6;
}
#input-void:focus-within{opacity:1;border-color:var(--accent);}
textarea{
  position:absolute;
  inset:-3px;
  padding:.6rem .9rem;
  border:none;
  background:#0000;
  color:var(--ink);
  outline:none;
  font:inherit;
  resize:none;
  line-height:2.1;
  border-radius:999px;
  transition:all .45s;
}
textarea::placeholder{color:#d7e6ff66;}
/* states -------------------------------------------------- */
.open textarea{
  width:calc(100vw - 10vw);
  max-width:46rem;
  height:6.8rem;
  border-radius:14px;
  padding-left:1.2rem;
  border:1px solid var(--accent);
  background:#ffffff08;
}
body:has(.open) #input-void{
  width:clamp(300px, 92vw, 46rem);
  height:7rem;
  border-radius:14px;
}
.close-btn{
  position:absolute;
  top:.9rem;
  right:1rem;
  background:none;
  border:none;
  color:var(--accent);
  font-size:.9rem;
  cursor:pointer;
  opacity:0;
  pointer-events:none;
}
.open .close-btn{opacity:1;pointer-events:auto;}
</style>
</head>

<body>
<canvas id="grain"></canvas>
<main id="board"></main>

<div id="input-void">
  <textarea placeholder="write…" rows="1"></textarea>
  <button class="close-btn" aria-label="close">✕</button>
</div>

<script>
/* 1. Noise canvas --------------------------------------------------------- */
(()=>{
  const c=document.getElementById('grain');
  const ctx=c.getContext('2d');
  const draw=()=>{
    c.width=innerWidth; c.height=innerHeight;
    const img=ctx.createImageData(c.width,c.height);
    for(let i=0;i<img.data.length;i+=4){
      const v=Math.random()*20;
      img.data[i]=img.data[i+1]=img.data[i+2]=v;
      img.data[i+3]=4;
    }
    ctx.putImageData(img,0,0);
  };
  draw(); addEventListener('resize',draw);
})();

/* 2. Ink-drop expansion & contraction ------------------------------------ */
const drop=document.getElementById('input-void');
const ta=drop.querySelector('textarea');
const closeBtn=document.querySelector('.close-btn');

function toggle(open){
  drop.classList.toggle('open',open);
  ta.rows=open?3:1;
}
ta.onfocus=()=>toggle(true);
closeBtn.onclick=e=>{
  e.preventDefault();
  ta.blur();
  toggle(false);
};
ta.addEventListener('keydown',e=>{
  if(e.key==='Enter' && !e.shiftKey){
    e.preventDefault();
    send();
  }
  if(e.key==='Escape'){
    toggle(false);
  }
});

/* 3. Chat loop ------------------------------------------------------------ */
const board=document.getElementById('board');
function add(text,isUser=false){
  const div=document.createElement('div');
  div.className='message '+(isUser?'user':'');
  div.innerHTML=`<p>${text}</p>`;
  board.appendChild(div);
  setTimeout(()=>div.classList.add('animate'),40);
  div.scrollIntoView({behavior:'smooth'});
}
function send(){
  const val=ta.value.trim();
  if(!val)return;
  add(val,true);
  ta.value='';
  toggle(false);
  setTimeout(()=>add("I waited until the ink settled before speaking above the night-board."),1000);
}
</script>

</body></html>
